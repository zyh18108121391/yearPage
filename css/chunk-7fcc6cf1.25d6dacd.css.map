{"version":3,"sources":["webpack:///src/components/src/components/tempalteBill.vue","webpack:///src/views/confirmBill/crew/D:/工作相关/mingxing/dldf/src/views/confirmBill/crew/crewDialog.vue","webpack:///src/views/confirmBill/crew/D:/工作相关/mingxing/dldf/src/views/confirmBill/crew/index.vue"],"names":[],"mappings":"AAkUA,+BACA,UAAA,CACA,WACA,CAEA,4BACA,cAAA,CACA,UAAA,CACA,gBACA,CAEA,qBACA,kCAEA,CAEA,qBACA,8BAEA,CAEA,uBACA,wBAEA,CCnIA,sCAEQ,eAAgB,CACnB,6BAID,UAAW,CACX,gBAAkB,CAClB,eAAiB,CACpB,2BAGG,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,eAAgB,CAJpB,+BAOQ,MAAO,CACV,0BAID,aAAc,CACd,cAAe,CACf,aAAc,CACd,cAAe,CAClB,8BAGG,eAAgB,CACnB,4BAGG,YAAa,CACb,qBAAsB,CACtB,kBAAoB,CACpB,iBAAkB,CAClB,OAAQ,CACR,QAAS,CACT,8BAAgC,CAEhC,4BAA6B,CAC7B,2BAA4B,CAC/B,6CAGG,MAAO,CACP,aAAc,CChDlB,uBACI,eAAmB,CACnB,qCAA8C,CAC9C,iBAAkB,CACrB,4BAGG,UAAW,CACX,aAAe,CACf,mBAAqB,CACrB,YAAa,CACb,kBAAmB,CACnB,4CAAkD,CANtD,gCASQ,iBAAkB,CAClB,WAAY,CACZ,kBAAoB,CACpB,UAAc,CACd,gBAAkB,CAClB,cAAe,CAdvB,4CAkBQ,mBAAqB,CAlB7B,uCAsBQ,uBAAyB,CAtBjC,6CA0BQ,UAAW,CACX,YAAc,CACd,UAAW,CACX,kBAAmB,CACnB,iBAAkB,CAClB,QAAS,CACT,WAAY,CACZ,0BAA2B,CAC9B,4BAID,cAAgB,CACnB,2BAGG,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACtB,0BAGG,cAAe,CACf,aAAc,CACjB,kCAGG,gBAAiB,CACjB,gBAAiB,CACpB,6BAGG,eAAgB","file":"chunk-7fcc6cf1.25d6dacd.css","sourcesContent":["<template>\n    <div id=\"templateBill\">\n        <div id=\"printArea\">\n            <v-runtime-template v-if=\"tempHtml&&tabData.list.length>0\" :template=\"tempHtml\"></v-runtime-template>\n        </div>\n        <!-- <el-button type=\"primary\" v-print=\"'#printArea'\">打 印</el-button> -->\n    </div>\n</template>\n<script>\n    import VRuntimeTemplate from \"v-runtime-template\";\n    import {\n        billDetail,\n        innerBills\n    } from '@/api/bill'\n    import moment from 'moment'\n    import {\n        getTemplate\n    } from '@/api/template'\n    export default {\n        name: 'tem',\n        components: {\n            VRuntimeTemplate,\n        },\n        props: {\n            type: {\n                type: Number,\n            },\n            tableData: {\n                type: Object,\n                default: () => {\n                    return {}\n                }\n            },\n\n        },\n        watch: {\n            type: {\n                deep: true,\n                handler(val) {\n                    this.hasStyle = false;\n                    this.initTemplate();\n                }\n            },\n            tableData: {\n                deep: true,\n                handler(val) {\n                    this.hasStyle = false;\n                    // this.initTemplate();\n                }\n            }\n        },\n        //  typeObj: {\n        //             1: '现场电量确认单',\n        //             2: '电量签认单',(内部)\n        //             3: '电量电费签认单v1',\n        //             4: '日用电明细表',\n        //             5: '昆仑结算单' \n        //         },\n        data() {\n            return {\n                hasStyle: false,\n                htmlText: '',\n                tempHtml: '',\n                classType: 1,\n                objClass: {\n                    1: {\n                        padding: \"45px 65px 0 68px\"\n                    }, //'现场电量确认单',\n                    2: {\n                        padding: \"45px 45px 0 45px\"\n                    }, //'电量签认单',(内部)\n                    3: {\n                        padding: \"45px 45px 0 45px\"\n                    }, //'电量电费签认单v1',\n                    4: {\n                        padding: \"45px 45px 0 45px\"\n                    }, //'日用电明细表',\n                    5: {\n                        padding: \"45px 45px 0 45px\"\n                    }, //'昆仑结算单' ,\n                    6: {\n                        padding: \"45px 65px 0 68px\"\n                    }, //'现场电量确认单'有补录\n                },\n                typeObj: {\n                    1: 1,\n                    2: 2,\n                    3: 3, //\n                    4: 4,\n                    5: 5,\n                    6: 6,\n                },\n                tabData: {\n                    list: [],\n                }\n            }\n        },\n        created() {\n\n        },\n        mounted() {\n            this.initTemplate();\n\n        },\n        beforeDestroy() {\n            // let body = document.body\n            // body.removeChild(body.childNodes[body.childNodes.length - 1]);\n            let templateBody = document.getElementById('templateBill')\n            // if (this.hasStyle) {\n            //     templateBody.removeChild(templateBody.childNodes[templateBody.childNodes.length - 1]);\n            // }\n\n        }, //\n\n        methods: {\n            initTemplate() {\n                this.classType = this.type;\n                this.queryType = this.type;\n\n                //替换备注信息字段（原来的备注字段修改为billNote)\n                this.tableData.excpReason = this.tableData.billNote ? this.tableData.billNote : ''\n                let tplId = ''\n                if (this.type == 1) { //现场电量确认单\n                    tplId = this.tableData.sitePaper;\n                    this.tabData = {\n                        ...this.tableData\n                    }\n                    this.tabData.createTime = moment(this.tableData.createTime).format('YYYY-MM-DD')\n                    this.tabData.list = []\n                    // console.log(111111, this.tableData)\n                    if (this.tableData.subBills && this.tableData.subBills.length > 0) {\n                        this.classType = 6; //补录\n                        let haveRecord = this.tableData.subBills.some(item => {\n                            return item.extraEq > 0\n                        })\n                        this.tabData.haveRecord = haveRecord;\n                        this.tabData.list = this.tableData.subBills.map(item => {\n                            item.arSrYear = moment(item.arSt).format('YYYY年MM月DD日'),\n                                item.arStHour = moment(item.arSt).format('HH时mm分'),\n                                item.arEtYear = moment(item.arEt).format('YYYY年MM月DD日'),\n                                item.arEtHour = moment(item.arEt).format('HH时mm分')\n                            return item\n                        })\n                    } else {\n                        if (this.tableData.extraEq > 0) this.tabData.haveRecord = true\n                        if (this.tableData.loseEq > 0) { // 长宁  有损耗分摊的\n                            this.tabData.haveRecord = true;\n                            tplId = 10;\n                        }\n                        this.tabData.list.push({\n                            arSrYear: moment(this.tableData.arSt).format('YYYY年MM月DD日'),\n                            arStHour: moment(this.tableData.arSt).format('HH时mm分'),\n                            arEtYear: moment(this.tableData.arEt).format('YYYY年MM月DD日'),\n                            arEtHour: moment(this.tableData.arEt).format('HH时mm分'),\n                            arSnum: this.tableData.arSnum,\n                            arEnum: this.tableData.arEnum,\n                            blRate: this.tableData.blRate,\n                            useEq: this.tableData.useEq,\n                            jpName: this.tableData.jpName,\n                            workType: this.tableData.workType,\n                            wkTyPrint: this.tableData.wkTyPrint,\n                            remark: this.tableData.remark,\n                            allEq: this.tableData.allEq,\n                            extraEq: this.tableData.extraEq, //补录\n                            loseEq: this.tableData.loseEq, //损耗\n                            createTime: moment(this.tableData.createTime).format('YYYY年MM月DD日'),\n                        })\n                    }\n                } else if (this.type == 2) {\n                    tplId = this.tableData.innerConfirm //内部确认单\n                    let str = this.tableData.billDate.trim()\n                    let index = str.indexOf('年')\n                    let year = str.substring(0, index)\n                    let month = str.substring(index + 1, str.length - 1)\n\n                    if (month < 10) month = '0' + month;\n                    let data = {\n                        billDate: year + '-' + month,\n                        company: this.tableData.company\n                    }\n                    innerBills(data).then(res => {\n                        this.tabData.totalEq = res.data ? res.data.totalEq : ''\n                        this.tabData.list = res.data ? res.data.jponts : []\n                        this.tabData.month = res.data ? res.data.month : ''\n                        this.tabData.billDate = this.tableData.billDate;\n                        this.tabData.list.map(item => {\n                            if (item.arSt.indexOf('年') == -1) {\n                                item.arSt = moment(item.arSt).format('YYYY年MM月DD日')\n                                item.arEt = moment(item.arEt).format('YYYY年MM月DD日')\n                            }\n                            return item\n                        })\n                    })\n                } else if (this.type == 3 || this.type == 5) { //外部确认单\n                    if (this.type == 3) tplId = this.tableData.externalConfirm1\n                    if (this.type == 5) tplId = this.tableData.externalConfirm2\n                    this.tabData = this.tableData;\n                    this.tabData.list = this.tableData.jpointInfos ? this.tableData.jpointInfos : []\n                    this.tabData.list.map(item => {\n                        if (item.arSt.indexOf('年') == -1) {\n                            item.arSt = moment(item.arSt).format('YYYY年MM月DD日')\n                            item.arEt = moment(item.arEt).format('YYYY年MM月DD日')\n                        }\n                        return item\n                    })\n                } else if (this.type == 4) { //日明细\n                    tplId = this.tableData.dayPaper;\n                    billDetail(this.tableData.id).then(res => {\n                        let leftLength = 18; //固定数据行数为18行\n                        this.tabData.allEq = this.tableData.allEq;\n                        let extraEq = this.tableData.extraEq //补录电量\n                        this.tabData.leftData = [];\n                        this.tabData.rightData = [];\n                        this.tabData.list = [];\n\n                        const list = res.data.map((item, index) => {\n                            if (item.day) {\n                                let date = new Date(item.day);\n                                let month = date.getMonth();\n                                let day = date.getDate()\n                                item.time = `${month+1}月${day}日`\n                            }\n                            item.mxRemark = '';\n                            if (index == 0) {\n                                let start = moment(this.tableData.arSt).format('DD日 HH:mm')\n                                item.mxRemark = `${start} 始`\n                            } else if (index === res.data.length - 1) {\n                                let end = moment(this.tableData.arEt).format('DD日 HH:mm')\n                                let hour = moment(this.tableData.arEt).format('HH:mm')\n                                if (hour === '00:00') {\n                                    let time = new Date(this.tableData.arEt).getTime() - 60 * 60 *\n                                        1000 * 24\n                                    let newEnd = moment(time).format('DD日 24:00')\n                                    item.mxRemark = `${newEnd} 止`\n                                } else {\n                                    item.mxRemark = `${end} 止`\n                                }\n                            }\n                            item.remark = item.remark ? item.remark : ''\n                            // if (index < 16) this.tabData.leftData.push(item)\n                            // else this.tabData.rightData.push(item)\n                            return item\n                        })\n\n                        for (let i = 0; i < 16; i++) {\n                            this.tabData.leftData.push(list[i] ? list[i] : {})\n                            this.tabData.rightData.push(list[16 + i] ? list[16 + i] : {})\n                        }\n                        if (extraEq) {\n                            this.tabData.rightData[15] = {\n                                time: '补录电量',\n                                remark: \"\",\n                                useEq: extraEq\n                            }\n                        }\n                        this.tabData.leftData.map((item, index) => {\n                            this.tabData.list.push({\n                                data: {\n                                    data1: item,\n                                    data2: this.tabData.rightData[index] ? this.tabData\n                                        .rightData[index] : {}\n                                }\n                            })\n                        })\n                        this.tabData.kpName = this.tableData.kpName;\n                        this.tabData.kwell = this.tableData.kwell;\n                        this.tabData.workType = this.tableData.workType;\n                        this.tabData.wkTyPrint = this.tableData.wkTyPrint;\n                        this.tabData.sdName = this.tableData.sdName;\n                        this.tabData.starDay = this.tableData.arSt ? moment(this.tableData.arSt).format(\n                            'YYYY年MM月DD日') : '';\n                        this.tabData.endDay = this.tableData.arEt ? moment(this.tableData.arEt).format(\n                            'YYYY年MM月DD日') : '';\n                    })\n\n                }\n\n\n                // if (this.type == 2 || this.type == 3 || this.type == 5) {\n                //     tplId = this.tableData.wkTy;\n                // } else {\n                //     // tplId = this.tableData.workType;\n                // }\n\n                this.getTemplate(tplId);\n\n            },\n            getTemplate(query) {\n                getTemplate(query).then(res => {\n                    if (res.code == 200) {\n                        if (res.data.length == 0) {\n                            this.$message({\n                                message: '未找到对应账单模板',\n                                type: 'error'\n                            })\n                            return\n                        }\n                        this.htmlText = res.data && res.data.template ? res.data.template : ''\n                        this.tempHtml = this.htmlText.substr(0, this.htmlText.indexOf(\"</template>\")).replace(\n                            '<template>', '');\n\n                        this.styleHtml = this.htmlText.substr(this.htmlText.indexOf(\"<style>\"));\n                        this.hasStyle = true\n                        let style = document.createElement('style')\n                        style.setAttribute(\"type\", \"text/css\");\n                        style.setAttribute(\"id\", \"style\");\n                        //解决打开打印 页面table样式影响的问题-zyh\n\n                        style.innerHTML = this.styleHtml.replace('<style>', '').replace('</style>', '').replace(\n                            'td {', '.print-body td {').replace(\n                            'td\\n\\t{', '.print-body td {').replace(\n                            'td\\r\\n\\t{', '.print-body td {').replace(\n                            /(.xl[0-9]+)/g, 'td$1');\n                        document.getElementById('printArea').appendChild(style)\n                    }\n\n                })\n            }\n        }\n    };\n</script>\n<style scoped>\n    #templateBill {\n        width: 100%;\n        height: auto\n    }\n\n    #printArea {\n        font-family: '宋体';\n        color: #000;\n        margin-right: 1px;\n    }\n\n    .mx {\n        padding: 45px 35px 0 35px !important;\n        /*no*/\n    }\n\n    .xc {\n        padding: .45rem .65rem 0 .65rem;\n        /*no*/\n    }\n\n    .xc-b {\n        padding: 45px 15px 0 15px;\n        /*no*/\n    }\n</style>","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.crewDigo {\n    ::v-deep .el-dialog {\n        margin-top: 80vh;\n    }\n}\n\n.comonTitle {\n    color: #333;\n    font-size: 0.14rem;\n    font-weight: bold;\n}\n\n.infoItem {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 10px;\n    margin-top: 10px;\n\n    div {\n        flex: 1;\n    }\n}\n\n.cus-btn {\n    color: #2e4af7;\n    font-size: 14px;\n    padding: 0 2px;\n    cursor: pointer;\n}\n\n.dialogTable {\n    margin-top: 10px;\n}\n\n.el-dialog {\n    display: flex;\n    flex-direction: column;\n    margin: 0 !important;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    /*height:600px;*/\n    max-height: calc(100% - 30px);\n    max-width: calc(100% - 30px);\n}\n\n.el-dialog .el-dialog__body {\n    flex: 1;\n    overflow: auto;\n}\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.crew {\n    background: #ffffff;\n    box-shadow: 0px 2px 4px 0px rgba(0, 0, 0, 0.1);\n    border-radius: 6px;\n}\n\n.crew-head {\n    width: 100%;\n    height: 0.55rem;\n    padding-left: 0.25rem;\n    display: flex;\n    align-items: center;\n    border-bottom: 1px solid rgba(151, 151, 151, 0.17);\n\n    div {\n        position: relative;\n        height: 100%;\n        line-height: 0.55rem;\n        color: #333333;\n        font-size: 0.14rem;\n        cursor: pointer;\n    }\n\n    div:nth-child(1) {\n        margin-right: 0.34rem;\n    }\n\n    .is-active {\n        color: #244bff !important;\n    }\n\n    .is-active::after {\n        content: \"\";\n        width: 0.31rem;\n        height: 3px;\n        background: #244bff;\n        position: absolute;\n        left: 50%;\n        bottom: -1px;\n        transform: translateX(-50%);\n    }\n}\n\n.crew-cont {\n    padding: 0.24rem;\n}\n\n.handBtns {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.handBtn {\n    cursor: pointer;\n    color: #244bff;\n}\n\n.crew-pagination {\n    padding-top: 20px;\n    text-align: right;\n}\n\n.print-body {\n    min-height: 7rem;\n}\n"]}