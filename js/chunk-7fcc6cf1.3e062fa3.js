(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7fcc6cf1"],{"14f1":function(t,a,e){"use strict";e("7570")},"21dc":function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"home commpage"},[e("div",{staticClass:"crew"},[e("div",{staticClass:"crew-head common-pfc"},[e("el-tabs",{on:{"tab-click":t.tabClick},model:{value:t.queryFrom.status,callback:function(a){t.$set(t.queryFrom,"status",a)},expression:"queryFrom.status"}},[e("el-tab-pane",{attrs:{label:"待确认电量账单",name:"0"}}),e("el-tab-pane",{attrs:{label:"历史确认账单",name:"1"}})],1)],1),e("div",{staticClass:"crew-cont"},[e("div",{staticClass:"crew-table"},[e("el-table",{attrs:{data:t.tableData,"header-cell-style":{background:"#E6EAFE",color:"#606266"}}},[e("el-table-column",{attrs:{type:"index",label:"序号",width:"200px"}}),e("el-table-column",{attrs:{prop:"kpName",label:"平台"}}),e("el-table-column",{attrs:{prop:"sdName",label:"用能单位"}}),e("el-table-column",{attrs:{label:"起止码时间"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",[t._v(" "+t._s(a.row.arSt?t.formatDate(a.row.arSt):"")+"—"+t._s(a.row.arEt?t.formatDate(a.row.arEt):"")+" ")])]}}])},[t._v("> ")]),e("el-table-column",{attrs:{label:"操作",align:"left",fixed:"right","class-name":"small-padding fixed-width",width:"100"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"handBtns"},[e("div",{staticClass:"handBtn",on:{click:function(e){return t.handDetail(a.row,a.row.id)}}},[t._v("查看")]),e("div",{staticClass:"handBtn",on:{click:function(e){return t.handPrint(a.row)}}},[t._v("打印")])])]}}])},[t._v("> ")])],1)],1),e("div",{staticClass:"crew-pagination"},[e("el-pagination",{attrs:{"current-page":t.queryFrom.pageNum,"page-sizes":[10,20,50,100],"page-size":t.queryFrom.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(a){return t.$set(t.queryFrom,"pageNum",a)},"update:current-page":function(a){return t.$set(t.queryFrom,"pageNum",a)}}})],1)])]),e("CrewDialog",{attrs:{dialogVisible:t.dialogVisible,dialogTable:t.dialogTable,dialogBaseData:t.dialogBaseData,status:t.queryFrom.status,id:t.billId},on:{cancel:t.handleClose,getList:t.getList}}),e("el-dialog",{attrs:{title:1==t.printType?"电量确认单":"日用电明细单",visible:t.open,width:"65%","before-close":t.cancle,top:"80vh"},on:{"update:visible":function(a){t.open=a}}},[e("el-tabs",{model:{value:t.printType,callback:function(a){t.printType=a},expression:"printType"}},[e("el-tab-pane",{attrs:{label:"电量确认单",name:"1"}},[e("div",{staticClass:"print-body"},[1==t.printType?e("TempalteBill",{attrs:{type:1,tableData:t.detailData}}):t._e()],1)]),"KC0001"===t.detailData.kcCode?e("el-tab-pane",{attrs:{label:"日用电明细单",name:"4"}},[e("div",{staticClass:"print-body"},[4==t.printType?e("TempalteBill",{attrs:{type:4,tableData:t.detailData}}):t._e()],1)]):t._e()],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.cancle}},[t._v("取消")]),e("el-button",{directives:[{name:"print",rawName:"v-print",value:t.printObj,expression:"printObj"}],attrs:{type:"primary"}},[t._v("打 印")])],1)],1)],1)},l=[],r=e("5530"),n=e("cccf"),s=e("6041"),o=e("2f62"),c=e("ed08"),d=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"crewDigo"},[e("el-dialog",{attrs:{title:"提示",visible:t.dialogVisible,width:"65%","before-close":t.handleClose,top:"80vh"},on:{"update:visible":function(a){t.dialogVisible=a}}},[e("div",{staticClass:"dialogCont",attrs:{id:"billDetail"}},[e("div",{staticClass:"comonTitle"},[t._v("基本信息")]),e("div",{staticClass:"infoItem"},[e("div",{staticStyle:{flex:"2"}},[t._v("井队名称："+t._s(t.dialogBaseData.sdName))]),e("div",[t._v("平台名称："+t._s(t.dialogBaseData.kwell))]),e("div")]),e("div",{staticClass:"comonTitle"},[t._v("时间")]),e("div",{staticClass:"infoItem"},[e("div",[t._v(" 起止时间："+t._s(t.moment(t.dialogBaseData.arSt).format("YYYY-MM-DD"))+" 至 "+t._s(t.moment(t.dialogBaseData.arEt).format("YYYY-MM-DD"))+" ")])]),e("div",{staticClass:"comonTitle"},[t._v("计量表信息")]),e("div",{staticClass:"infoItem"},[e("div",[t._v("起码："+t._s(t.dialogBaseData.arSnum))]),e("div",[t._v("止码： "+t._s(t.dialogBaseData.arEnum))]),e("div",[t._v("倍率： "+t._s(t.dialogBaseData.blRate))]),e("div")]),e("div",{staticClass:"comonTitle"},[t._v("电量信息")]),e("div",{staticClass:"infoItem"},[e("div",[t._v("电量："+t._s(t.dialogBaseData.useEq))]),e("div",[t._v("线损电量： "+t._s(t.dialogBaseData.loseEq))]),e("div",[t._v("补录电量： "+t._s(t.dialogBaseData.extraEq))]),e("div",[t._v("总电量： "+t._s(t.dialogBaseData.allEq))])]),e("div",{staticClass:"comonTitle"},[t._v("申请信息")]),e("div",{staticClass:"infoItem"},[e("div",[t._v("申请人： "+t._s(t.dialogBaseData.applyPerson))]),e("div",[t._v("申请时间： "+t._s(t.dialogBaseData.applyTime?t.moment(t.dialogBaseData.applyTime).format("YYYY-MM-DD HH:mm:ss"):"-")+" ")]),e("div",[t._v("总电量： "+t._s(t.dialogBaseData.allEq))]),e("div")]),e("div",{staticClass:"comonTitle"},[t._v("详情")]),e("div",{staticClass:"dialogTable"},[e("el-table",{attrs:{data:t.dialogTable,height:"300","header-cell-style":{background:"#E6EAFE",color:"#606266"}}},t._l(t.tableRows,(function(a){return e("el-table-column",{key:a.prop,attrs:{prop:a.prop,label:a.label},scopedSlots:t._u([{key:"default",fn:function(i){return["day"===a.prop?e("div",[t._v(t._s(t.moment(i.row[a.prop]).format("YYYY-MM-DD"))+" ")]):e("div",[t._v(t._s(i.row[a.prop]))])]}}],null,!0)})})),1)],1)]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[1==t.status?e("div",[e("el-button",{on:{click:t.handleClose}},[t._v("取 消")])],1):e("div",[e("el-button",{attrs:{type:"primary"},on:{click:t.subimt}},[t._v("确 认")])],1)])])],1)},p=[],m=(e("a9e3"),e("c1df")),u=e.n(m),b={name:"crewDialog",components:{TempalteBill:s["a"]},props:{dialogVisible:{type:Boolean,default:!1},dialogTable:{type:Array,default:function(){return[]}},dialogBaseData:{type:Object},id:{type:Number,default:"0"},status:status},data:function(){return{moment:u.a,tableRows:[{prop:"day",label:"日期"},{prop:"useEq",label:"电量"},{prop:"remark",label:"备注"}]}},computed:Object(r["a"])({},Object(o["c"])({userId:function(t){return t.user.userId}})),created:function(){this.tableD=this.dialogBaseData},mounted:function(){},methods:{handleClose:function(){this.$emit("cancel",!1)},subimt:function(){this.sureBill()},prints:function(){this.printExcel("billDetail")},sureBill:function(){var t=this,a={userId:this.userId,id:this.id};Object(n["d"])(a).then((function(a){t.$message({message:"账单确认成功！",type:"success"}),t.$emit("cancel",!1),t.$emit("getList")})).catch((function(a){t.$emit("cancel",!1)}))},printExcel:function(t){var a="<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'></head>",e="<style>\n            .comonTitle{color: #333;font-size: 0.14rem;font-weight: bold;}\n            .infoItem{ display: flex;justify-content: space-between;margin-bottom: 0.1rem;margin-top: 0.1rem;}\n            .infoItem div{ flex: 1;}\n            .comonTitle{color: #333;font-size: 0.14rem;font-weight: bold;}\n            table{width:100%;display:table-cell!important;box-sizing:border-box;}\n            .el-table__header,.el-table__body,.el-table__footer{width:100%!important;border-collapse: collapse;text-align:center;}\n            table,table tr th, table tr td { border:1px solid #ddd;color:#606266;word-wrap:break-word}\n            table tr th,table tr td{padding:4mm 0mm;word-wrap:break-word }\n            .el-table__body, tr td .cell{width:100%!important}\n            .el-table th.gutter{display: none;}\n            .el-table colgroup.gutter{display: none;}\n            </style><body>",i="",l=document.getElementById(t).innerHTML;i+=l,a=a+e+i+"</body></html>";var r=window.open("_blank");r.document.write(a),r.document.close(),r.focus(),setTimeout((function(){r.print(),r.close()}),500)}}},h=b,f=(e("14f1"),e("2877")),D=Object(f["a"])(h,d,p,!1,null,"4898ad2a",null),v=D.exports,g=e("5c96"),y={name:"crew",components:{CrewDialog:v,TempalteBill:s["a"]},data:function(){return{dialogVisible:!1,formatDate:c["c"],tabs:["待确认电量账单","历史确认账单"],billId:null,queryFrom:{pageNum:1,pageSize:10,status:0,userId:""},total:0,currentPage:1,tableData:[],tableRows:[{label:"平台",kpName:"kpName"},{label:"用能单位",kpName:"sdName"},{label:"起止码时间",prop:"用能单位"},{width:"100",label:"操作",prop:"",fixed:!0}],dialogTable:[],dialogBaseData:{},open:!1,printType:"1",detailData:{},printObj:{id:"printArea",popTitle:"　"}}},created:function(){this.getBills()},computed:Object(r["a"])({},Object(o["c"])({userId:function(t){return t.user.userId}})),mounted:function(){},methods:{handleClose:function(){this.dialogVisible=!1},cancle:function(){this.open=!1},getBills:function(){var t=this;this.queryFrom.userId=this.userId,Object(n["b"])(this.queryFrom).then((function(a){t.tableData=a.rows,t.total=a.total}))},tabClick:function(){this.queryFrom.pageNum=1,this.getBills()},handDetail:function(t,a){this.dialogBaseData=t,this.billId=a,this.getDetail(a)},getList:function(){this.getBills()},getDetail:function(t){var a=this;Object(n["a"])(t).then((function(t){a.dialogTable=t.data,a.dialogVisible=!0})).catch((function(t){Object(g["Message"])()}))},handleSizeChange:function(t){this.queryFrom.pageSize=t},handleCurrentChange:function(t){this.queryFrom.pageNum=t},handPrint:function(t){this.open=!0,this.detailData=t,this.printType="1"}},activated:function(){this.getBills()},deactivated:function(){this.tableData=[]}},_=y,E=(e("897f"),Object(f["a"])(_,i,l,!1,null,"6ae45d48",null));a["default"]=E.exports},6041:function(t,a,e){"use strict";var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{attrs:{id:"templateBill"}},[e("div",{attrs:{id:"printArea"}},[t.tempHtml&&t.tabData.list.length>0?e("v-runtime-template",{attrs:{template:t.tempHtml}}):t._e()],1)])},l=[],r=(e("99af"),e("c975"),e("d81d"),e("45fc"),e("a9e3"),e("ac1f"),e("5319"),e("498a"),e("5530")),n=function(t,a,e){if(!a.hasOwnProperty(e)){var i=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(a,e,i)}},s={props:{template:String,parent:Object,templateProps:{type:Object,default:function(){return{}}}},render:function(t){if(this.template){var a=this.parent||this.$parent,e=a.$data;void 0===e&&(e={});var i=a.$props;void 0===i&&(i={});var l=a.$options;void 0===l&&(l={});var r=l.components;void 0===r&&(r={});var s=l.computed;void 0===s&&(s={});var o=l.methods;void 0===o&&(o={});var c=this.$data;void 0===c&&(c={});var d=this.$props;void 0===d&&(d={});var p=this.$options;void 0===p&&(p={});var m=p.methods;void 0===m&&(m={});var u=p.computed;void 0===u&&(u={});var b=p.components;void 0===b&&(b={});var h={$data:{},$props:{},$options:{},components:{},computed:{},methods:{}};Object.keys(e).forEach((function(t){void 0===c[t]&&(h.$data[t]=e[t])})),Object.keys(i).forEach((function(t){void 0===d[t]&&(h.$props[t]=i[t])})),Object.keys(o).forEach((function(t){void 0===m[t]&&(h.methods[t]=o[t])})),Object.keys(s).forEach((function(t){void 0===u[t]&&(h.computed[t]=s[t])})),Object.keys(r).forEach((function(t){void 0===b[t]&&(h.components[t]=r[t])}));var f=Object.keys(h.methods||{}),D=Object.keys(h.$data||{}),v=Object.keys(h.$props||{}),g=Object.keys(this.templateProps),y=D.concat(v).concat(f).concat(g),_=(w=a,Y={},f.forEach((function(t){return n(w,Y,t)})),Y),E=function(t){var a={};return t.forEach((function(t){t&&Object.getOwnPropertyNames(t).forEach((function(e){return n(t,a,e)}))})),a}([h.$data,h.$props,_,this.templateProps]);return t({template:this.template||"<div></div>",props:y,computed:h.computed,components:h.components,provide:this.$parent._provided},{props:E})}var w,Y}},o=e("cccf"),c=e("c1df"),d=e.n(c),p=e("b775");function m(t){return Object(p["c"])({method:"get",url:"/dl/basic/print/template/"+t})}var u={name:"tem",components:{VRuntimeTemplate:s},props:{type:{type:Number},tableData:{type:Object,default:function(){return{}}}},watch:{type:{deep:!0,handler:function(t){this.hasStyle=!1,this.initTemplate()}},tableData:{deep:!0,handler:function(t){this.hasStyle=!1}}},data:function(){return{hasStyle:!1,htmlText:"",tempHtml:"",classType:1,objClass:{1:{padding:"45px 65px 0 68px"},2:{padding:"45px 45px 0 45px"},3:{padding:"45px 45px 0 45px"},4:{padding:"45px 45px 0 45px"},5:{padding:"45px 45px 0 45px"},6:{padding:"45px 65px 0 68px"}},typeObj:{1:1,2:2,3:3,4:4,5:5,6:6},tabData:{list:[]}}},created:function(){},mounted:function(){this.initTemplate()},beforeDestroy:function(){document.getElementById("templateBill")},methods:{initTemplate:function(){var t=this;this.classType=this.type,this.queryType=this.type,this.tableData.excpReason=this.tableData.billNote?this.tableData.billNote:"";var a="";if(1==this.type)if(a=this.tableData.sitePaper,this.tabData=Object(r["a"])({},this.tableData),this.tabData.createTime=d()(this.tableData.createTime).format("YYYY-MM-DD"),this.tabData.list=[],this.tableData.subBills&&this.tableData.subBills.length>0){this.classType=6;var e=this.tableData.subBills.some((function(t){return t.extraEq>0}));this.tabData.haveRecord=e,this.tabData.list=this.tableData.subBills.map((function(t){return t.arSrYear=d()(t.arSt).format("YYYY年MM月DD日"),t.arStHour=d()(t.arSt).format("HH时mm分"),t.arEtYear=d()(t.arEt).format("YYYY年MM月DD日"),t.arEtHour=d()(t.arEt).format("HH时mm分"),t}))}else this.tableData.extraEq>0&&(this.tabData.haveRecord=!0),this.tableData.loseEq>0&&(this.tabData.haveRecord=!0,a=10),this.tabData.list.push({arSrYear:d()(this.tableData.arSt).format("YYYY年MM月DD日"),arStHour:d()(this.tableData.arSt).format("HH时mm分"),arEtYear:d()(this.tableData.arEt).format("YYYY年MM月DD日"),arEtHour:d()(this.tableData.arEt).format("HH时mm分"),arSnum:this.tableData.arSnum,arEnum:this.tableData.arEnum,blRate:this.tableData.blRate,useEq:this.tableData.useEq,jpName:this.tableData.jpName,workType:this.tableData.workType,wkTyPrint:this.tableData.wkTyPrint,remark:this.tableData.remark,allEq:this.tableData.allEq,extraEq:this.tableData.extraEq,loseEq:this.tableData.loseEq,createTime:d()(this.tableData.createTime).format("YYYY年MM月DD日")});else if(2==this.type){a=this.tableData.innerConfirm;var i=this.tableData.billDate.trim(),l=i.indexOf("年"),n=i.substring(0,l),s=i.substring(l+1,i.length-1);s<10&&(s="0"+s);var c={billDate:n+"-"+s,company:this.tableData.company};Object(o["c"])(c).then((function(a){t.tabData.totalEq=a.data?a.data.totalEq:"",t.tabData.list=a.data?a.data.jponts:[],t.tabData.month=a.data?a.data.month:"",t.tabData.billDate=t.tableData.billDate,t.tabData.list.map((function(t){return-1==t.arSt.indexOf("年")&&(t.arSt=d()(t.arSt).format("YYYY年MM月DD日"),t.arEt=d()(t.arEt).format("YYYY年MM月DD日")),t}))}))}else 3==this.type||5==this.type?(3==this.type&&(a=this.tableData.externalConfirm1),5==this.type&&(a=this.tableData.externalConfirm2),this.tabData=this.tableData,this.tabData.list=this.tableData.jpointInfos?this.tableData.jpointInfos:[],this.tabData.list.map((function(t){return-1==t.arSt.indexOf("年")&&(t.arSt=d()(t.arSt).format("YYYY年MM月DD日"),t.arEt=d()(t.arEt).format("YYYY年MM月DD日")),t}))):4==this.type&&(a=this.tableData.dayPaper,Object(o["a"])(this.tableData.id).then((function(a){t.tabData.allEq=t.tableData.allEq;var e=t.tableData.extraEq;t.tabData.leftData=[],t.tabData.rightData=[],t.tabData.list=[];for(var i=a.data.map((function(e,i){if(e.day){var l=new Date(e.day),r=l.getMonth(),n=l.getDate();e.time="".concat(r+1,"月").concat(n,"日")}if(e.mxRemark="",0==i){var s=d()(t.tableData.arSt).format("DD日 HH:mm");e.mxRemark="".concat(s," 始")}else if(i===a.data.length-1){var o=d()(t.tableData.arEt).format("DD日 HH:mm"),c=d()(t.tableData.arEt).format("HH:mm");if("00:00"===c){var p=new Date(t.tableData.arEt).getTime()-864e5,m=d()(p).format("DD日 24:00");e.mxRemark="".concat(m," 止")}else e.mxRemark="".concat(o," 止")}return e.remark=e.remark?e.remark:"",e})),l=0;l<16;l++)t.tabData.leftData.push(i[l]?i[l]:{}),t.tabData.rightData.push(i[16+l]?i[16+l]:{});e&&(t.tabData.rightData[15]={time:"补录电量",remark:"",useEq:e}),t.tabData.leftData.map((function(a,e){t.tabData.list.push({data:{data1:a,data2:t.tabData.rightData[e]?t.tabData.rightData[e]:{}}})})),t.tabData.kpName=t.tableData.kpName,t.tabData.kwell=t.tableData.kwell,t.tabData.workType=t.tableData.workType,t.tabData.wkTyPrint=t.tableData.wkTyPrint,t.tabData.sdName=t.tableData.sdName,t.tabData.starDay=t.tableData.arSt?d()(t.tableData.arSt).format("YYYY年MM月DD日"):"",t.tabData.endDay=t.tableData.arEt?d()(t.tableData.arEt).format("YYYY年MM月DD日"):""})));this.getTemplate(a)},getTemplate:function(t){var a=this;m(t).then((function(t){if(200==t.code){if(0==t.data.length)return void a.$message({message:"未找到对应账单模板",type:"error"});a.htmlText=t.data&&t.data.template?t.data.template:"",a.tempHtml=a.htmlText.substr(0,a.htmlText.indexOf("</template>")).replace("<template>",""),a.styleHtml=a.htmlText.substr(a.htmlText.indexOf("<style>")),a.hasStyle=!0;var e=document.createElement("style");e.setAttribute("type","text/css"),e.setAttribute("id","style"),e.innerHTML=a.styleHtml.replace("<style>","").replace("</style>","").replace("td {",".print-body td {").replace("td\n\t{",".print-body td {").replace("td\r\n\t{",".print-body td {").replace(/(.xl[0-9]+)/g,"td$1"),document.getElementById("printArea").appendChild(e)}}))}}},b=u,h=(e("a0fe"),e("2877")),f=Object(h["a"])(b,i,l,!1,null,"0da3eade",null);a["a"]=f.exports},7570:function(t,a,e){},"897f":function(t,a,e){"use strict";e("8a63")},"8a63":function(t,a,e){},a0fe:function(t,a,e){"use strict";e("ac01")},ac01:function(t,a,e){},cccf:function(t,a,e){"use strict";e.d(a,"b",(function(){return l})),e.d(a,"a",(function(){return r})),e.d(a,"d",(function(){return n})),e.d(a,"c",(function(){return s}));var i=e("b775");function l(t){return Object(i["c"])({method:"get",url:"dl/bill/",params:t})}function r(t){return Object(i["c"])({method:"get",url:"dl/bill/get/"+t})}function n(t){return Object(i["c"])({method:"post",url:"dl/bill/confirm",data:t})}function s(t){return Object(i["c"])({method:"get",url:"dl/bill/comfirm/list/innerBills",params:t})}}}]);
//# sourceMappingURL=chunk-7fcc6cf1.3e062fa3.js.map